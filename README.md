# Тестовое задание

Для настройки рабочего окружения используется инструмент [devenv](https://devenv.sh/getting-started/)
и [direnv](https://direnv.net/).

* `devenv` - Помогает в декларативной форме описывать рабочее окружение - устанавливать все необходимые зависимости, сервисы и т.п.
* `direnv` - Позволяет автоматически загружать рабочее окружение при переходе в директорию с проектом. Без него бы приходилось вызывать команду `devenv shell` в ручную.

То есть для установки всех необходимых зависимостей необходимо клонировать репозиторий

```
git clone git@github.com:badenkov/status_monitoring.git
cd status_monitoring
direnv allow
```

Затем необходимо установить зависимости

```
bundle install
bin/rails db:setup
```

и можно запустить проект.

```
bin/dev
```

и открыть проект в браузере `http://localhost:3000`


## Краткое описание технических решений

Старался следовать принципам https://dev.37signals.com/a-vanilla-rails-stack-is-plenty/
и обойтись тем, что есть в rails из коробки.

Попробовал использовать fixtures и minitest.

Модели:

* `MonitoredEndpoint` то, что мы мониторим
* `MonitoredEndpoint::Check` здесь храним результаты проверки

`MonitoredEnpoint` может быть 3 состояний - draft, ready, in_progress

В `MonitoredEndpoint` есть поле `next_launch_at` в котором сохраняется время следующей проверки. Оно рассчитывается при переходе в состояние `ready`

Фоновая задача `LaunchScheduledChecks` - планируется что будет запускать каждую минуту. Находит все `MonitoredEndpoint` которые пора проверить, и переводит их в состояние `in_progress`.

Фоновая задача `LaunchCheck` выполняет проверку - время загрузки и код ответа.

Для каждого энпоинта выводится отчет за последние 7 дней в виде таблицы. Данные отчета кэшируется, кэш сбрасывается при добавлении `MonitoredEndpoint::Check`
Для формирования отчета используется библиотека [groupdate](https://github.com/ankane/groupdate) - но так как используется sqlite, не учитываются таймзоны.

Страница с отчетом обновляется автоматически с помощью Hotwire.


